<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>KCI Case Tracker â€“ Upload Excel Creation Tool</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />

  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.8/css/jquery.dataTables.min.css" />
  <link rel="stylesheet" href="https://cdn.datatables.net/fixedheader/3.4.0/css/fixedHeader.dataTables.min.css" />
  <link rel="stylesheet" href="index.css" />
</head>
<body data-theme="dark">
  <header class="app-header">
    <div>
      <p class="eyebrow">KCI Case Tracker</p>
      <h1>Upload Excel Creation Tool</h1>
    </div>
    <div class="header-actions">
      <button id="themeToggle" class="ghost-button" title="Toggle theme">ðŸŒ™</button>
    </div>
  </header>

  <main class="app-shell">
    <section class="control-panel">
      <div class="panel-card">
        <h2>Source files</h2>
        <p class="panel-subtitle">Add the latest exports and process them one at a time.</p>

        <div class="upload-grid">
          <label class="upload-tile">
            <span>ðŸ“Š KCI â€“ Open Repair Case Data (Excel)</span>
            <input type="file" id="kciInput" accept=".xlsx" />
          </label>
          <label class="upload-tile">
            <span>ðŸ§¾ GNPro â€“ CSO Status File (CSV)</span>
            <input type="file" id="csoInput" accept=".csv" />
          </label>
          <label class="upload-tile">
            <span>ðŸšš Tracking Results File (CSV)</span>
            <input type="file" id="trackingInput" accept=".csv" />
          </label>
        </div>

        <button id="processBtn" class="primary-button" disabled>Process Selected File</button>
      </div>

      <div class="panel-card">
        <h2>Actions</h2>
        <p class="panel-subtitle">Generate copy-ready outputs and configuration data.</p>

        <div class="action-grid">
          <button id="copySoBtn">Copy SO Orders</button>
          <button id="copyTrackingBtn">Copy Tracking URLs</button>
          <button id="processRepairBtn" class="accent">Process Repair Data</button>
          <button id="sbdBtn">SBD Cut Off Times</button>
          <button id="tlBtn">TL</button>
          <button id="marketBtn">Market</button>
        </div>
      </div>
    </section>

    <section class="data-panel">
      <div class="data-panel-header">
        <h2>Case data workspace</h2>
        <p class="panel-subtitle">Browse each dataset to validate and export insights.</p>
      </div>
      <div id="tablesContainer"></div>
    </section>
  </main>

  <div id="soModal" class="modal-overlay" style="display:none;">
    <div class="modal">
      <div class="modal-header">
        <h3 id="soModalTitle">Copy SO Orders Preview</h3>
      </div>
      <div class="modal-body">
        <div id="soCount" class="modal-meta"></div>
        <textarea id="soOutput" readonly></textarea>
      </div>
      <div class="modal-actions">
        <button id="copyToClipboardBtn" class="primary-button">Copy to Clipboard</button>
        <button id="closeModalBtn" class="ghost-button">Close</button>
      </div>
    </div>
  </div>

  <div id="tlModal" class="modal-overlay" style="display:none;">
    <div class="modal">
      <div class="modal-header">
        <h3>TL Assignment</h3>
      </div>
      <div class="modal-body">
        <div class="tl-market-scroll">
          <div id="tlContainer" class="mapping-grid"></div>
        </div>
        <button class="ghost-button add-row" id="addTlBtn">+ Add TL</button>
      </div>
      <div class="modal-actions">
        <button id="saveTlBtn" class="primary-button">Save</button>
        <button class="ghost-button" onclick="closeModal('tlModal')">Close</button>
      </div>
    </div>
  </div>

  <div id="marketModal" class="modal-overlay" style="display:none;">
    <div class="modal">
      <div class="modal-header">
        <h3>Market Assignment</h3>
      </div>
      <div class="modal-body">
        <div class="tl-market-scroll">
          <div id="marketContainer" class="mapping-grid"></div>
        </div>
        <button class="ghost-button add-row" id="addMarketBtn">+ Add Market</button>
      </div>
      <div class="modal-actions">
        <button id="saveMarketBtn" class="primary-button">Save</button>
        <button class="ghost-button" onclick="closeModal('marketModal')">Close</button>
      </div>
    </div>
  </div>

  <div id="sbdModal" class="modal-overlay" style="display:none;">
    <div class="modal modal-large">
      <div class="modal-header">
        <h3>SBD Cut Off Times</h3>
      </div>
      <div class="modal-body">
        <div class="sbd-periods"></div>
      </div>
      <div class="modal-actions">
        <button id="saveSbdBtn" class="primary-button">Save</button>
        <button id="closeSbdBtn" class="ghost-button">Close</button>
      </div>
    </div>
  </div>

  <div id="progressOverlay" class="progress-overlay" style="display:none;">
    <div class="progress-card">
      <p id="overlayStatusText" class="overlay-status"></p>
      <div class="overlay-progress-bar">
        <div id="overlayProgressBar">
          <span id="overlayProgressText">0%</span>
        </div>
      </div>
      <button id="overlayConfirmBtn" class="primary-button" style="display:none;">OK</button>
    </div>
  </div>

  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.8/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/fixedheader/3.4.0/js/dataTables.fixedHeader.min.js"></script>
  <script src="index.js"></script>
</body>
</html>
